---
title: "開新檔案/開啓舊檔/存檔/另存新檔，四大天王"
date: 2012-08-14T10:27:00.004+08:00
tags: 
- "WIN32 API/MFC"
categories:
- 舊部落格移植文章
---

# 開新檔案/開啓舊檔/存檔/另存新檔，四大天王

原文連結: https://darkblack01.blogspot.com/2012/08/blog-post_14.html
移植時的最後更新日期: 2012-08-14T17:28:50.216+08:00

<br /><ul><li>開新檔案 &nbsp;</li><li>開啓舊檔&nbsp;</li><li>存檔&nbsp;</li><li>另存新檔</li></ul><br />這四個是（SDI或MDI）很常見的程式段。<br />但是常見到網路上找不到，很多細節又...還是找不到。<br /><br />所以貼一貼好了！<br />藍色部份為自己打的code。<br />黑色部份為系統生成code。<br />其它色彩為相對應呼叫的結構。<br /><br /><b><span style="font-size: large;">Sample Code:</span></b><br /><a name='more'></a><br /><br /><b>開新檔案（3個副程式）</b><br /><b><br /></b>//開啓程式，第一個執行的檔案初始化（只執行一次）<br />BOOL CColorEyeIDoc::OnNewDocument()<br />{<br />&nbsp; &nbsp; if (!CDocument::OnNewDocument())<br />&nbsp; &nbsp; &nbsp; &nbsp; return FALSE;<br /><br />&nbsp; &nbsp; // TODO: add reinitialization code here<br />&nbsp; &nbsp; // (SDI documents will reuse this document)<br /><span style="color: #3d85c6;">&nbsp; &nbsp; //第一次執行時會執行這個</span><br /><span style="color: #0b5394;">&nbsp; &nbsp;&nbsp;</span><span style="color: #38761d;">NewOmdData</span><span style="color: #0b5394;">();</span><br /><br />&nbsp; &nbsp; return TRUE;<br />}<br /><br />//開新檔案的檔案初始化，按「開新檔案」時執行<br />void CColorEyeIDoc::OnFileNew()<br />{<br />&nbsp; &nbsp; // TODO: Add your command handler code here<br /><span style="color: #3d85c6;">&nbsp; &nbsp; //開新檔案</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; SetPathName(" "); &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: #cc0000;">//不可以丟空字串，會產生錯誤，看了Source Code才明白</span><br /><span style="color: #3d85c6;">&nbsp; &nbsp; delete f_Omd;</span><br /><span style="color: #0b5394;">&nbsp; &nbsp;&nbsp;</span><span style="color: #38761d;">NewOmdData();</span><span style="color: #3d85c6;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;//叫新的Omd</span><br /><span style="color: #3d85c6;"></span><span style="color: #0b5394;">&nbsp; &nbsp; UpdateAllViews(NULL); </span><span style="color: #3d85c6;">&nbsp;//更新畫面</span><br /><span style="color: #3d85c6;">}</span><br /><br /><br />void CColorEyeIDoc::<span style="color: #38761d;">NewOmdData()</span><br />{<br /><span style="color: #0b5394;">&nbsp; &nbsp; SetTitle("新的Omd檔");</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; vChain1.clear(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #3d85c6;">//清空記憶體空間vChain1</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; f_Omd = new COmdFile1; &nbsp; </span><span style="color: #3d85c6;">//新增Omd檔（刪掉會開不了）</span><br />}<br /><br /><br /><b>開啟舊檔</b><b>（1個副程式）</b><br /><br />void CColorEyeIDoc::OnFileOpen()<br />{<br />&nbsp; &nbsp; // TODO: Add your command handler code here<br /><span style="color: #0b5394;">&nbsp; &nbsp; CFileDialog aFileDialog (TRUE, NULL, NULL, OFN_SHAREAWARE | OFN_OVERWRITEPROMPT, m_strFilter);</span><br /><span style="color: #0b5394;">&nbsp; &nbsp;&nbsp;</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; int nID = aFileDialog.DoModal();</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; if (nID == IDOK)</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; {</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: #e69138;">RestructureVector();</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; if(f_Omd-&gt;Open(aFileDialog.GetPathName()))</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetPathName(aFileDialog.GetPathName());</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetTitle(aFileDialog.GetFileName());</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; }</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; UpdateAllViews(NULL);</span><br />}<br /><br /><br /><b>存檔和另存新檔</b><b>（2個副程式）</b><br /><br />void CColorEyeIDoc::<span style="color: #741b47;">OnFileSaveAs</span>()<br />{<br />&nbsp; &nbsp; // TODO: Add your command handler code here<br /><span style="color: #0b5394;">&nbsp; &nbsp; CFileDialog fSaveDlg (FALSE, "omd", "*.omd", OFN_SHAREAWARE, m_strFilter); &nbsp;</span><span style="color: #3d85c6;">//存檔會自己加副檔名</span><br /><span style="color: #0b5394;"><br /></span><span style="color: #0b5394;">&nbsp; &nbsp; int nID = fSaveDlg.DoModal();</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; if (nID == IDOK)</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; {</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: #e69138;">RestructureVector</span><span style="color: #e69138;">();</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; if (f_Omd-&gt;Save(fSaveDlg.GetPathName()))</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; {</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetTitle(fSaveDlg.GetFileName());</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; SetPathName(fSaveDlg.GetPathName());</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; }</span><br />}<br /><br />void CColorEyeIDoc::OnFileSave()<br />{<br />&nbsp; &nbsp; // TODO: Add your command handler code here<br /><span style="color: #0b5394;">&nbsp; &nbsp; if (vChain1.empty()) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span style="color: #3d85c6;">//若開了新檔</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; </span><span style="color: #741b47;">OnFileSaveAs</span><span style="color: #0b5394;">(); &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span style="color: #3d85c6;">//就另存新檔</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; else</span><br /><span style="color: #0b5394;">&nbsp; &nbsp; &nbsp; &nbsp; f_Omd-&gt;Save(GetPathName());</span><br />}<br /><br /><br /><b>另外將vector放進Omd裡</b><br /><br />void CColorEyeIDoc::<span style="color: #e69138;">RestructureVector()</span><br />{<br />&nbsp; &nbsp; if (!vChain2.empty())<br />&nbsp; &nbsp; {<br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //在這時</span><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //vChain1是舊的</span><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //vChain2是新的</span><br />&nbsp; &nbsp; &nbsp; &nbsp; std::vector&lt;Cartridge&gt;::iterator it2, itX;<br /><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //remove &amp; cut</span><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //在新的裡面，比對舊的，代表重覆</span><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //重覆量測去除掉</span><br />&nbsp; &nbsp; &nbsp; &nbsp; for (it2 = vChain2.begin(); it2 != vChain2.end(); ++it2)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; itX = std::remove(vChain1.begin(), vChain1.end(), *it2);<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; vChain1.erase(itX, vChain1.end());<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br /><br />&nbsp; &nbsp; &nbsp; &nbsp; //<span style="color: #999999;">將舊的掛在新的後面（讓空的放在第一個）</span><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //整串變成舊的那一串</span><br /><span style="color: #999999;">&nbsp; &nbsp; &nbsp; &nbsp; //放回Omd檔</span><br />&nbsp; &nbsp; &nbsp; &nbsp; vChain2.insert(vChain2.end(), vChain1.begin(), itX);<br />&nbsp; &nbsp; &nbsp; &nbsp; vChain1 = vChain2;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; else if (vChain1.empty())<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; Cartridge x;<br />&nbsp; &nbsp; &nbsp; &nbsp; vChain1.push_back(x);<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; f_Omd-&gt;SetMsrData(vChain1);<br />}
