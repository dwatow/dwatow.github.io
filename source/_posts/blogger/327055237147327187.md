---
title: "C++單元測試(9) - CppUnit輸出Xml, Jenkins顯示Report"
date: 2015-06-24T15:40:00.000+08:00
tags: 
- "TDD"
- "C_and_Cpp"
- "Jenkins"
categories:
- 舊部落格移植文章
---

# C++單元測試(9) - CppUnit輸出Xml, Jenkins顯示Report

原文連結: https://darkblack01.blogspot.com/2015/06/cppunitxml-jenkinsreport.html
移植時的最後更新日期: 2015-12-23T14:16:57.657+08:00

這次的標題，下得很「關鍵字」<br />這次的故事是這樣的，使用CppUnit單元測試框架，使用Jenkins的CI系統+xUnitTest的plug-in。<br /><br />要讓CppUnit輸出Xml，再讓xUnitTest的plug-in吃到Xml，在Jenkins上顯示。<br /><br /><h2><span style="font-size: x-large;">第一步，就是先看單元測試專案的main怎麼改[1] </span></h2><pre class="prettyprint"><code>int main()<br />{<br />    CppUnit::TestResult testresult;<br />    CppUnit::TestResultCollector collectedresults;<br />    testresult.addListener (&amp;collectedresults);<br /><br />    CppUnit::TextUi::TestRunner runner;<br />    CppUnit::TestFactoryRegistry &amp;registry = CppUnit::TestFactoryRegistry::getRegistry();<br />    runner.addTest( registry.makeTest() );<br />    runner.run(testresult);<br /><br />    std::ofstream xmlFileOut("CppUnitTestDmServerResults.xml");<br />    CppUnit::XmlOutputter xmlOut(&amp;collectedresults, xmlFileOut);<br />    xmlOut.write();<br /><br />    return 0;<br />}</code></pre><br />主要就是要讓 testresult 放進 runner.run(testresult) 參數中。<br />這樣Xml輸出就會有東西了。<br /><br /><h2><span style="font-size: x-large;">接下來就是設定Jenkins。</span></h2>Jenkins加上xUnitTest的plug-in很多文章都有寫。就不多說了。<br />進入你Job的設定裡<br />要注意的如下<br /><br /><ol><li>建置時要建置單元測試專案</li><li>建置後要執行單元測試的執行檔。(輸出xml)</li><li>xUnitTest的plug-in要吃的，也只是xml檔。</li></ol><h3><span style="font-size: large;">建置時要建置單元測試專案</span></h3><div>在Visual Studio上，就是要設定.sln檔，在某種Config時，是不是會建置呢？(要把單元測試的專案打勾唷)<br /><br /></div><h3><span style="font-size: large;">建置後要執行單元測試的執行檔。</span></h3>在Jos的建置，加上一個「執行Windows批次指令」，執行單元測試執行檔。<br />(當然如果你是Linux系統，就要加一個「執行Shell」)<br /><br /><h3><span style="font-size: large;">xUnitTest的plug-in要吃的，也只是xml檔。 </span></h3>在Jos的建置後動作，加上Publish xUnit test result report<br />在裡面再加上一個CppUnit-1.12.1 (default)<br />其中Pattern的欄位，填入單元測試專案的xml路徑檔名<br /><br />剩下的就照說明填囉~<br /><br /><br />參考資料: [1] <a href="https://schneide.wordpress.com/2008/09/29/using-hudson-for-ccmakecppunit/">Using Hudson for C++/CMake/CppUnit - Posted by volkerkaiser</a>
