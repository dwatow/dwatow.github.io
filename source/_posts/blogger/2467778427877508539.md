---
title: MFC用在Excel（語法+註解篇）
date: 2010-11-20T12:37:00.000+08:00
tags: 
- WIN32 API/MFC

categories:
- 舊部落格移植文章
---

# MFC用在Excel（語法+註解篇）

原文連結: https://darkblack01.blogspot.com/2010/11/mfcexcel.html
移植時的最後更新日期: 2014-03-03T15:05:55.173+08:00

<b>初始化</b><pre class="prettyprint"><code>objApp.CreateDispatch("Excel.Application",&e) //產生一個Excel應用程式<br />objApp.SetVisible(TRUE); //繪出Excel應用程式視窗<br />objBooks = objApp.GetWorkbooks(); //取得應用程式的活頁簿記憶體位址<br />objBook = objBooks.Add(VOptional); //開新檔案<br />objBook.AttachDispatch(objBooks.Add(_variant_t("C:\\test.xls"))); //開啟舊檔（也可以叫Dlg出來用）<br />objSheets = objBook.GetWorksheets(); //取得Books的Sheet記憶體位址<br />objSheet = objSheets.GetItem(COleVariant((short)1)); //開啟sheet1（就是點一下Sheet1翻到這一頁）<br />objSheet.SetName("My Sheet"); //設定sheet1的名稱稱</code></pre><br /><b>設定內容</b><br /><pre class="prettyprint"><code>range = objSheet.GetRange(COleVariant("A1"),COleVariant("A1")); //選取Sheet的範圍（使用Excel座標）<br />range.SetColumnWidth(_variant_t((float)1.2)); //設定欄寬（像素值）<br />range.SetItem(_variant_t((long)1),_variant_t((long)1),_variant_t("My Auto-Excel Demo")); //填入內容<br />range.BorderAround(_variant_t((long)1),3,1,_variant_t((long)#000000)); //外框<br />range.SetHorizontalAlignment(COleVariant((short)3)); //置中<br />range.SetMergeCells(_variant_t(true)); //合併儲存格<br />range.SetColumnWidth(_variant_t((float)30.38)); //設定欄寬<br />range.SetRowHeight(_variant_t((float)54.00)); //設定欄高<br />col = range.GetEntireColumn(); //選取某個範圍的一整排<br />col.AutoFit(); //自動調整一整排的欄寬<br />（列同理）</code></pre><br /><b>設定字型</b><br /><pre class="prettyprint"><code>font = range.GetFont(); //取得選取範圍，設定字型的記憶體位址<br />font.SetName(_variant_t("Arial")); //設定字型<br />font.SetSize(_variant_t((short)12)); //設定字體大小pt<br />font.SetBold(_variant_t((short)TRUE)); //粗體<br />font.SetColorIndex(_variant_t((short)5)); //字色（查表，應該還有更好的方法）</code></pre><br /><b>設定儲存格</b><br /><pre class="prettyprint"><code>cell = range.GetInterior(); //取得選取範圍，設定儲存格的記憶體位址<br />cell.SetColorIndex(_variant_t((short)5)); //設定底色（查表）</code></pre><br /><b>其它</b><br /><pre class="prettyprint"><code>char buf[200]; //暫存的字串<br />ZeroMemory(buf,sizeof(buf)); //清空記憶體<br />sprintf(buf,"A%c33",'A'+i-11); //用變數定義儲存格座標<br />strcpy(buf,"總計"); //定義欲輸入的字串</code></pre><br /><b>圖表</b><br /><pre class="prettyprint"><code>//畫圖<br />lpDisp = objSheet.ChartObjects(VOptional);<br />chartobjects.AttachDispatch(lpDisp); // Attach the lpDisp pointer for ChartObjects to the chartobjects object.<br />chartobject = chartobjects.Add(20, 140, 350, 250); //defines the rectangle,<br />// adds a new chart at that rectangle and assigns its object reference to a ChartObject variable named chartobject<br />xlsChart.AttachDispatch(chartobject.GetChart()); // GetChart() returns LPDISPATCH, and this attaches it to your chart object.<br />lpDisp = objSheet.GetRange(COleVariant("B3"), COleVariant("F6")); // The range containing the data to be charted.<br />range.AttachDispatch(lpDisp);<br />var.vt = VT_DISPATCH;<br />// .vt is the usable member of the tagVARIANT Struct. Its value is a union of options.<br />var.pdispVal = lpDisp; // Assign IDispatch pointer of the Source range to var.<br />xlsChart.ChartWizard(<br />var, // Source.<br />COleVariant((short)11), // Gallery: 3d Column.<br />VOptional, // Format, use default.<br />COleVariant((short)1), // PlotBy: xlRows.<br />COleVariant((short)1), // CategoryLabels.<br />_variant_t("Open,Working,Verify,Returned,Closed,Canceled"), <br />COleVariant((short)1), // SeriesLabels.<br />COleVariant((short)TRUE), // HasLegend.<br />VOptional, //COleVariant("Use by Month"), // Title.<br />VOptional, //COleVariant("Month"), // CategoryTitle.<br />VOptional, //COleVariant("Usage in Thousands"), // ValueTitles.<br />VOptional // ExtraTitle.<br />);<br />xlsChart.SetChartType((long)55); //設定圖表類型（查表：圖表種類篇）<br />//調刻度<br />/*_Axis ax = xlsChart.Axes(_variant_t((short)2),_variant_t((short)1)); //2是縱軸, 1不清楚<br />sc = ax.GetMaximumScale();<br />if(sc < 5.0)<br />{<br />chart.SetAutoScaling(FALSE);<br />ax.SetMajorUnitIsAuto(FALSE);<br />ax.SetMajorUnit(1);<br />ax.SetMinorUnitIsAuto(FALSE);<br />ax.SetMinorUnit(1);<br />//ax.SetMinorUnitScale(1);<br />ax.SetMaximumScale((long)(sc+1)); //最大刻度<br />}*/</code></pre><br /><b>結尾</b><br /><pre class="prettyprint"><code>objApp.SetUserControl(TRUE);<br />range.ReleaseDispatch();chartobject.ReleaseDispatch();<br />chartobjects.ReleaseDispatch();objSheet.ReleaseDispatch();<br />objSheets.ReleaseDispatch();objBook.ReleaseDispatch();<br />objBooks.ReleaseDispatch();<br />objApp.ReleaseDispatch();</code></pre><br />參考資料：<br /><br />流浪小築 <a href="http://www.blogger.com/blogger.g?blogID=1853319424565477074">http://www.intra.idv.tw/</a>
