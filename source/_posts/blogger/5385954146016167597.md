---
title: MARCO in C++ 愈用愈好用的地方
date: 2015-11-06T10:56:00.002+08:00
tags: 
- C_and_Cpp

categories:
- 舊部落格移植文章
---

# MARCO in C++ 愈用愈好用的地方

原文連結: https://darkblack01.blogspot.com/2015/11/marco-in-c.html
移植時的最後更新日期: 2015-12-23T14:16:57.690+08:00

MARCO，是c語言的特性。<br />c++為了c也將它收進來。<br />c++的使用者，不一定是c高手，MARCO也就不一定用得好。<br />c++的使用者，不一定是c++高手，同上！XD<br /><br />所以，MARCO用得讓人覺得程式怎麼愈寫愈....不開心。<br />是時有所聞~<br /><br />MARCO包起來的，我認為是c語言時代的「程式碼片段」(比起翻譯成什麼「宏」來得好一點^^)<br /><br />那麼要如何時用呢？<br /><h2><span style="font-size: x-large;">預防再次宣告(.h檔常用)</span></h2>先看例子 <br /><pre class="prettyprint"><code>#ifndef MY_CLASS_H<br />#define MY_CLASS_H<br /><br />class MyClass<br />{<br />    //...<br />};<br />#endif</code></pre><h3><span style="font-size: large;">語法解釋</span></h3><ul><li>#ifndef MY_CLASS_H 如果，還沒有定義過MyClass這個字</li><li>#define MY_CLASS_H 定義MY_CLASS_H這個字</li><li>#endif 結束MACRO的if</li></ul><h2><span style="font-size: x-large;">條件編譯</span></h2>程式碼參考自<a href="http://www.apibook.com/Chapter_3.pdf" rel="nofollow" target="_blank">C++ API Design Ch3 p.68</a><br /><pre class="prettyprint"><code><br />// autotimer.h<br />#ifdef _WIN32<br />#include <windows .h=""><br />#else<br />#include <sys time.h=""><br />#endif<br />#include <string><br />class AutoTimer<br />{<br />    //...<br />#ifdef _WIN32<br />    DWORD mStartTime;<br />#else<br />    struct timeval mStartTime;<br />#endif<br />};</string></sys></windows></code></pre><h3><span style="font-size: large;">語法解釋</span></h3><ol><li>#ifdef _WIN32 如果定義了_WIN32<br />IDE會幫你在編譯時選定的一個參數。<br />也許是_DEBUG，指的是要進入debug模式。</li></ol><h2><span style="font-size: x-large;">取代參數化的容器初始化</span></h2>在此，希望程式內部使用enum取代string。 <br />外部傳入string，在程式內部會置換成enum<br /><pre class="prettyprint"><code><br />enum AType<br />{<br />    A1 = 0, A2, A3, ATotal<br />}<br /></code></pre><pre class="prettyprint"><code>map&lt;std::string,&nbsp;</code>AType&gt; ATypeMap;</pre>如果不使用MARCO，會麼寫。(也許有更好的寫法啦) <br /><pre class="prettyprint"><code>ATypeMap["A1test"] = A1;<br />ATypeMap["A2test"] = A2;<br />ATypeMap["A3test"] = A3;</code></pre>如果使用MARCO，程式碼就可以這樣寫。 <br /><pre class="prettyprint"><code>#define ADD_MAP(x) ATypeMap[#x test] = x<br /><br />ADD_MAP(A1);<br />ADD_MAP(A2);<br />ADD_MAP(A3);</code></pre><h3><span style="font-size: large;">語法解釋 </span></h3>MARCO的參數[1]<br /><ol><li>參數變成字串，參數前要加上#</li><li>參數變成字元，參數前要加上#@</li><li>參數要和唯讀字串組合成新字串，參數前要加上#，並和唯讀字串隔一個空白。</li></ol><h2><span style="font-size: x-large;">參考資料:</span></h2>[1] <a href="http://puremonkey2010.blogspot.tw/2011/04/c-c-define.html" target="_blank">[C++ 文章收集] C++中 #define的用法 - 程式扎記</a>
