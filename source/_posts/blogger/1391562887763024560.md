---
title: ".txt 檔處理"
date: 2012-02-17T00:37:00.000+08:00
tags: 
- "WIN32 API/MFC"
categories:
- 舊部落格移植文章
---

# .txt 檔處理

原文連結: https://darkblack01.blogspot.com/2012/02/txt.html
移植時的最後更新日期: 2012-02-17T00:38:10.411+08:00

在.xls（Excel檔）裡，有一格一格的<br />在.csv裡用\t和\n可以讓它一格一格的，x軸和y軸都可以定位<br />同理<br />在txt檔和.csv檔骨子裡是一樣的，不一樣的是打開的工具<br /><br />而今天，我們用MFC來開<br />如何coding來開這個東西呢？？（至少要能讀.txt檔吧？）<br /><br /><a name='more'></a><br /><br /><br />先貼兩串code上來看<br /><br /><br /><b><span style="color: blue;">CString </span></b><span style="color: blue;">CTxtFile</span>::<span style="color: #660000;">GetLine</span>(<b><span style="color: blue;">UINT </span></b><span style="color: #073763;">Num</span>)<br />{<br />&nbsp; &nbsp; <b><span style="color: blue;">CString </span></b><span style="color: #073763;">strBuf1</span>;<br />&nbsp; &nbsp; <b><span style="color: blue;">CString </span></b><span style="color: #073763;">strBuf2</span>;<br />&nbsp; &nbsp; <span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">Format</span>("%s", <span style="color: #073763;">pbuf</span>);<br />&nbsp; &nbsp; <b><span style="color: blue;">UINT </span></b><span style="color: #073763;">lBegin</span> = 0, <span style="color: #073763;">lLength </span>= 0;<br />&nbsp; &nbsp; <span style="color: blue;"><b>for</b> </span>(<span style="color: blue;"><b>UINT </b></span><span style="color: #073763;">i</span> = 0; <span style="color: #073763;">i</span> &lt; Num; ++<span style="color: #073763;">i</span>)<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">lLength </span>= <span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">Right</span>(<span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">GetLength</span>() - <span style="color: #073763;">lBegin</span>).<span style="color: #660000;">Find</span>("\n");<br />&nbsp; &nbsp; &nbsp; &nbsp; <b><span style="color: blue;">if </span></b>(<span style="color: #073763;">lLength </span>== -1) &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <b><span style="color: blue;">return </span></b>"超過檔案大小";<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">Format</span>("%s", <span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">Mid</span>(<span style="color: #073763;">lBegin</span>, <span style="color: #073763;">lLength</span>));<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">TrimRight</span>();<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">lBegin </span>= <span style="color: #073763;">lBegin </span>+ <span style="color: #073763;">lLength </span>+ 1;<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <b><span style="color: blue;">if </span></b>(<span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">IsEmpty</span>())<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">Format</span>("(內容空白)");<br />&nbsp; &nbsp; <b><span style="color: blue;">return </span></b><span style="color: #073763;">strBuf2</span>;<br />}<br /><br /><br /><br /><br /><b><span style="color: blue;">CString </span></b><span style="color: blue;">CTxtFile</span>::<span style="color: #660000;">GetCell</span>(<span style="color: blue;"><b>UINT</b></span> <span style="color: #073763;">Word</span>, <span style="color: blue;"><b>UINT </b></span><span style="color: #073763;">Line</span>)<br />{<br />&nbsp; &nbsp;&nbsp;<b><span style="color: blue;">CString&nbsp;</span></b>&nbsp;<span style="color: #073763;">strBuf1</span>;<br />&nbsp; &nbsp;&nbsp;<b><span style="color: blue;">CString&nbsp;</span></b>&nbsp;<span style="color: #073763;">strBuf2</span>;<br />&nbsp; &nbsp; <span style="color: #073763;">strBuf1 </span>= <span style="color: #660000;">GetLine</span>(Line);<br />&nbsp; &nbsp; <b><span style="color: blue;">if </span></b>(!<span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">IsEmpty</span>())<br />&nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;"><b>UINT </b></span><span style="color: #073763;">wBegin </span>= 0, <span style="color: #073763;">wLength </span>= 0;<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: blue;"><b>for </b></span>(<b style="color: blue;">UINT</b>&nbsp;<span style="color: #073763;">i</span> = 0; <span style="color: #073763;">i</span> &lt; <span style="color: #073763;">Word</span>; ++<span style="color: #073763;">i</span>)<br />&nbsp; &nbsp; &nbsp; &nbsp; {<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">wLength </span>= <span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">Right</span>(<span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">GetLength</span>() - <span style="color: #073763;">wBegin</span>).<span style="color: #660000;">Find</span>("\t");<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">Format</span>("%s", <span style="color: #073763;">strBuf1</span>.<span style="color: #660000;">Mid</span>(<span style="color: #073763;">wBegin</span>, <span style="color: #073763;">wLength</span>));<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">TrimRight</span>();<br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <br />&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">wBegin </span>+= <span style="color: #073763;">wLength </span>+ 1;<br />&nbsp; &nbsp; &nbsp; &nbsp; }<br />&nbsp; &nbsp; }<br />&nbsp; &nbsp; <span style="color: blue;">if </span>(<span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">IsEmpty</span>())<br />&nbsp; &nbsp; &nbsp; &nbsp; <span style="color: #073763;">strBuf2</span>.<span style="color: #660000;">Format</span>("(內容空白)");<br />&nbsp; &nbsp; <b><span style="color: blue;">return </span></b><span style="color: #073763;">strBuf2</span>;<br />}<br /><br />字串 &gt; 子字串 &gt; 小字串<br /><br />GetLine()，不是一般使用介面，設成private，也可以設計成public<br />是用來得到一行，也就是用\n切斷文章，成為一串串的子字串。<br />CString::TrimRight()的目的是去掉右邊的空白、\n、\t（在這裡主要去掉\t和空格）<br />（相對的也有左邊版本）<br />GetCell()是一般使用的介面，設成public<br />填入座標，以\t介定x方向的格式，以\n介定y方向的格子。<br />就可以任意的處理txt檔，取出任意的小字串<br /><br />小字串可以使用<br />CString::Left()、CString::Mid()、CString::Right()<br />做細部的處理。
