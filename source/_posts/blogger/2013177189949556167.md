---
title: C++單元測試(11) - OpenCppCoverage可視化單元測試的覆蓋率, Jenkins顯示Report
date: 2015-12-04T16:49:00.002+08:00
tags: 
- TDD
,- C_and_Cpp
,- Jenkins

categories:
- 舊部落格移植文章
---

# C++單元測試(11) - OpenCppCoverage可視化單元測試的覆蓋率, Jenkins顯示Report

原文連結: https://darkblack01.blogspot.com/2015/12/c11-opencppcoverage-jenkinsreport.html
移植時的最後更新日期: 2015-12-23T14:16:57.621+08:00

這一次，我們來討論一下，如何將unit test的成果可視化，也就是常見的覆蓋率(Coverage rate)。<br /><br />我們採用的環境如下<br />Visual Studio <complete id="goog_1830503976">+ git<span id="goog_1830503977"></span><span id="goog_1830503978"></span></complete>&nbsp;+ CppUnit&nbsp;+ Jenkins&nbsp;+ OpenCppCoverage<br /><br />這樣一來，在Visual Studio寫好的code提交到git後，Jenkins會輪詢git，若改版就抓一版過來;li 呼叫MSBuild編譯，編譯好就編譯CppUnit，然後執行CppUnit編好的執行檔，產生單元測試的Report，之後再執行cppcheck，產生Report，最後執行這一次的主角OpenCppCoverage，產生Report。<br /><br />條列式的呈現，如下<br /><br /><ol><li>Visual Studio寫好的code提交到git後</li><li>Jenkins會輪詢git，若改版就抓一版過來</li><li>呼叫MSBuild編譯主程式+編譯CppUnit</li><li>執行CppUnit編好的執行檔，產生單元測試的Report</li><li>執行cppcheck，產生Report</li><li>執行OpenCppCoverage，產生Report。</li></ol><br />第六步，是我們今天討論的內容。<br /><br /><h2><span style="font-size: x-large;">下載軟體</span></h2>到<a href="https://opencppcoverage.codeplex.com/releases/view/616848" target="_blank">官方網站下載</a>OpenCppCoverage。<br />安裝到Jenkins的主機上(可以先安裝在自己的電腦先測試，執行成功再裝在Jenkins的主機上)<br /><br /><h2><span style="font-size: x-large;">準備Command</span></h2>參考<a href="https://opencppcoverage.codeplex.com/documentation" target="_blank">官網的文件</a>，上面的訊息就足夠了。<br />自己本機測試，可以使用這樣的command<br /><pre class="prettyprint"><code>OpenCppCoverage --sources &lt;souce code的路徑&gt; -- &lt;你的單元測試程式.exe&gt; </code></pre>可以<a href="https://opencppcoverage.codeplex.com/wikipage?title=Jenkins" target="_blank">參考這篇</a>，Jenkins上，則要這樣寫(加上--export_type=cobertura)<br /><pre class="prettyprint"><code>OpenCppCoverage --sources &lt;souce code的路徑&gt; --export_type=cobertura -- &lt;你的單元測試程式.exe&gt;</code></pre><br /><h2><span style="font-size: x-large;">安裝Jenkins外掛</span></h2>安裝Cobertura plugin <br /><br /><h2><span style="font-size: x-large;">可能會遇到的問題</span></h2><h3><span style="font-size: large;">為什麼報表都沒有值？(Xml是空的？)</span></h3>因為，需要.pdb檔。<br />建議使用debug模式編譯，因為除了.pdb檔本來就應該在debug模式產生之外，最好不要將code最佳化，造成無法辨別.pdb內容的情況。<br /><br />所以，我在Jenkins上的設定，分別設定兩個job，一個是release編譯，一個是debug編譯。等debug編好，就執行unit test、coverage、static code analysis...，通通成功了，再編譯release。<br /><br /><h2><span style="font-size: x-large;">實例</span></h2>為了方便瀏覽，在此有用斷行，真正使用的指令，無需斷行，但是要加空白。 <br /><pre class="prettyprint"><code>OpenCppCoverage --sources &lt;產品程式碼路徑&gt;<br />--excluded_sources &lt;前置編譯路徑&gt;<br />--excluded_sources &lt;前置編譯.lib的.h檔 路徑&gt;<br />--excluded_sources &lt;單元測試路徑&gt;<br />--excluded_sources &lt;使用.dll, .lib檔的.h檔 路徑&gt;<br />--excluded_sources &lt;其它編譯完, 編譯器幫你用到的檔案路徑&gt;<br />-- &lt;單元測試達行檔&gt;</code></pre>
