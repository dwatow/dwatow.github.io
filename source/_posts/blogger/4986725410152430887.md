---
title: "ODBC with MFC sample code"
date: 2014-03-05T09:52:00.001+08:00
tags: 
- "資料庫"
categories:
- 舊部落格移植文章
---

# ODBC with MFC sample code

原文連結: https://darkblack01.blogspot.com/2014/03/odbc-with-mfc-sample-code.html
移植時的最後更新日期: 2014-03-05T10:17:10.523+08:00

不囉嗦，直接看程式  <br /><pre class="prettyprint"><code>#include &lt;afxdb.h&gt;<br /><br />//略過超多無關ODBC的程式碼<br />void CKXdbtestDlg::OnButton1() //在此寫在一個button做測試，可以用其它訊息觸發<br />{<br />    //宣告資料庫初始化(指定資料庫及帳密)<br />    //打開(table, 欄位 = *, R/W);  ??<br /><br />    CDatabase* kxDB = new CDatabase();  //資料庫本體物件<br />    kxDB-&gt;OpenEx( _T("DSN=MySQL;UID=root;PWD=root"),  //"DSN=ODBC資料來源名稱;UID=帳號;PWD=密碼"<br />                     CDatabase::openReadOnly | <br />                     CDatabase::noOdbcDialog );  //資料庫連線參數(唯讀|無對話框)<br />    <br />    CRecordset* kxRecordSet = new CRecordset(kxDB);  //代表指向資料的指標物件<br />    kxRecordSet-&gt;Open( CRecordset::snapshot,      //連線互動方式(是否即時更新??)<br />                       "SELECT * FROM traveler",  //輸入資炓庫指令<br />                       CRecordset::none);         //不知道設定什麼的位元遮罩<br /><br />    kxRecordSet-&gt;MoveNext();  //垂直移動，往下一個欄位<br /><br />    CString str, temp;       //下一行，取得水平儲存格總數(微軟很愛用counter當total)<br />    for (short i = 0; i &lt; kxRecordSet-&gt;GetODBCFieldCount(); ++i)<br />    {<br />        kxRecordSet-&gt;GetFieldValue(i, temp);  //水平移動，指定其中一個儲存格，並取出該欄位資料<br />        str += temp + "  ";<br />    }<br />    <br />    m_strShow.SetWindowText(str);<br /><br />    kxRecordSet-&gt;Close();<br />    kxDB-&gt;Close();  //資料庫斷線<br />}</code></pre>注意：此程式碼顯示在一個唯讀的controller上，所以沒有測試其寫入的部份。<br />參考資料：<br /><a href="http://msdn.microsoft.com/zh-tw/library/c689y99f(v=vs.80).aspx">CDatabase::OpenEx - MSDN</a><br /><a href="http://msdn.microsoft.com/zh-tw/library/1hkkwdf0(v=vs.80).aspx">CRecordset::Open - MSDN</a><br /><a href="http://msdn.microsoft.com/zh-tw/library/z9t2b0y9(v=vs.80).aspx">CRecordset::MoveNext - MSDN</a><br /><a href="http://msdn.microsoft.com/zh-tw/library/187cf96c(v=vs.80).aspx">CRecordset::GetODBCFieldCount - MSDN</a><br /><a href="http://msdn.microsoft.com/zh-tw/library/5f8k59f9(v=vs.80).aspx">CRecordset::GetFieldValue - MSDN</a><br />
