---
title: Code Complete II《軟體建構之道 2》#17 讀書心得與整理
date: 2013-07-16T15:45:00.003+08:00
tags: 
- Code Complete 2

categories:
- 舊部落格移植文章
---

# Code Complete II《軟體建構之道 2》#17 讀書心得與整理

原文連結: https://darkblack01.blogspot.com/2013/07/unusual-control-structures-17.html
移植時的最後更新日期: 2013-07-16T15:46:59.094+08:00

<h2><span style="font-size: x-large;">第十七章 不常見的流程控制程式結冓<br />Unusual Control Structures</span></h2><br /><h3><span style="font-size: large;">17.1 常式的多重回傳<br />Multiple Returns from a Routine</span></h3><br />在任何時候離開常式的方法。<br /><br /><b>return可以提高可讀性的時候</b><br /><ol><li>獲得解答，要立即回傳</li><li>不返回就得寫更多的程式碼跳過別的程式碼</li></ol><b>使用防衛子句(guard clause)簡化複雜的錯誤處理</b><br /><pre class="prettyprint"><code class="language-cpp">if (A is true)<br />    if (B is true)<br />        if (C is true)<br />            //...</code></pre>不如改成 <pre class="prettyprint"><code class="language-cpp">if (A isn't true)<br />    return notA;<br /><br />if (B isn't true)<br />    return notB;<br /><br />if (C isn't true)<br />    return notC;<br /><br />//...everything is right</code></pre><a name='more'></a>簡潔。但是，<b>在產品代碼中，還須要更多的程式碼來處理這些not的狀況</b>。<br /><pre class="prettyprint"><code class="language-cpp">if (A isn't true)<br />{<br />    status = Error_A;<br />    return notA;<br />}<br /><br />if (B isn't true)<br />{<br />    status = Error_B;<br />    return notB;<br />}<br /><br />if (C isn't true)<br />{<br />    status = Error_C;<br />    return notC;<br />}<br /><br />//...everything is right<br /></code></pre>更可以讓有相關性的陳述式在一起(Scop縮小)，提高可維護性和可讀性。<br /><br /><b>將每個常式的return數量降低</b><br /><ul><li>在增加可讀性時增加數量</li><li>在降低可讀性時降低數量</li></ul><br /><br /><h3><span style="font-size: large;">17.2 遞迴<br />Recursion</span></h3><br />可產生優雅的解決方法，就用遞迴<br />用於小問題，產生簡單、正確的解決方案<br /><br /><h3>遞迴使用心得<br />Tips for Using Recursion</h3><br />留一個非遞迴的路徑，當作停止遞迴的出口<br />防止無限遞迴，考慮使用安全計數器，預防堆疊溢位<br />多常式遞迴，很危險，請保持在單一常式<br />使用new創造物件，不要讓它是auto創造出來。<br />不要使用遞迴運算階乘和數列的問題<br /><br /><br /><h3><span style="font-size: large;">17.3 goto()語法<br />goto</span></h3><br /><h4>反對goto的論點<br />The Argument Against gotos</h4><ul><li>含有goto的程式碼沒有品質</li><li>邏輯結構無法利用排版凸顯</li><li>編譯器無法最佳化</li></ul><h4>支持goto的論點<br />The Argument for gotos</h4><ul><li>goto使程式碼更快或更小</li><li>減少重覆的程式碼</li></ul><h4>關於goto的假辨論<br />The Phony goto Debate</h4><br />結論：即使明白所有可以避開goto的程式技巧，但有時候使用goto卻可以提高可讀性和可維護性<br /><br /><h4>goto與錯誤處理時<br />Error Processing and gotos</h4><br /><span style="font-size: large;"><b>goto版</b></span><br /><pre class="prettyprint"><code class="language-vb">errorState = FileStatus_Success<br />fileIndex = 0<br /><br />While ( fileIndex &lt; numFilesToPurge ) And ( errorState = FileStatus_Success )<br /> <br />   fileIndex = fileIndex + 1<br /><br />    If Not ( FindFile( fileList( fileIndex ), fileToPurge ) ) <br />    Then<br />        errorState = FileStatus_FileFindError<br />        GoTo END_PROC<br />    End If<br /><br />    If Not OpenFile( fileToPurge ) <br />    Then<br />        errorState = FileStatus_FileOpenError<br />        GoTo END_PROC<br />    End If<br /><br />    If Not OverwriteFile( fileToPurge ) <br />    Then<br />        errorState = FileStatus_FileOverwriteError<br />        GoTo END_PROC<br />    End If<br /><br />    If Erase( fileToPurge ) <br />    Then<br />        errorState = FileStatus_FileEraseError<br />        GoTo END_PROC<br />    End If<br />End While<br /><br />DeletePurgeFileList( fileList, numFilesToPurge )</code></pre><span style="font-size: large;"><b>深巢狀if版 </b></span><br /><pre class="prettyprint"><code class="language-vb">errorState = FileStatus_Success<br />fileIndex = 0<br /><br />While ( fileIndex &lt; numFilesToPurge ) And ( errorState = FileStatus_Success )<br /> <br />   fileIndex = fileIndex + 1<br /><br />    If FindFile( fileList( fileIndex ), fileToPurge ) <br />    Then<br />        If OpenFile( fileToPurge ) <br />        Then<br />            If OverwriteFile( fileToPurge ) <br />            Then<br />                If Not Erase( fileToPurge ) <br />                Then<br />                    errorState = FileStatus_FileEraseError<br />                End If<br />            Else ' couldn\'t overwrite file'<br />                errorState = FileStatus_FileOverwriteError<br />            End If<br />        Else ' couldn\'t open file'<br />            errorState = FileStatus_FileOpenError<br />        End If<br />    Else ' couldn\'t find file'<br />        errorState = FileStatus_FileFindError<br />    End If<br />End While<br /><br />DeletePurgeFileList( fileList, numFilesToPurge )</code></pre><b><span style="font-size: large;">Status變數版 </span></b><br /><pre class="prettyprint"><code class="language-vb">errorState = FileStatus_Success<br />fileIndex = 0<br /><br />While ( fileIndex &lt; numFilesToPurge ) And ( errorState = FileStatus_Success )<br /><br />    fileIndex = fileIndex + 1<br /><br />    If Not FindFile( fileList( fileIndex ), fileToPurge ) <br />    Then<br />        errorState = FileStatus_FileFindError<br />    End If<br /><br />    If ( errorState = FileStatus_Success ) <br />    Then<br />        If Not OpenFile( fileToPurge ) <br />        Then<br />            errorState = FileStatus_FileOpenError<br />        End If<br />    End If<br /><br />    If ( errorState = FileStatus_Success ) <br />    Then<br />        If Not OverwriteFile( fileToPurge ) <br />        Then<br />            errorState = FileStatus_FileOverwriteError<br />        End If<br />    End If<br /><br />    If ( errorState = FileStatus_Success ) <br />    Then<br />        If Not Erase( fileToPurge ) Then<br />            errorState = FileStatus_FileEraseError<br />        End If<br />    End If<br />End While<br /><br />DeletePurgeFileList( fileList, numFilesToPurge )</code></pre><b><span style="font-size: large;">try-finally版 </span></b><br /><pre class="prettyprint"><code class="language-vb">Try<br />    fileIndex = 0<br />    While ( fileIndex &lt; numFilesToPurge )<br />        fileIndex = fileIndex + 1<br />        FindFile( fileList( fileIndex ), fileToPurge )<br />        OpenFile( fileToPurge )<br />        OverwriteFile( fileToPurge )<br />        Erase( fileToPurge )<br />    Wend<br />    Finally<br />        DeletePurgeFileList( fileList, numFilesToPurge )<br />End Try</code></pre><br /><table border="1" cellpadding="5" cellspacing="0"><tbody><tr>  <td>寫法&nbsp;</td>  <td>goto版</td>  <td>深巢狀if版</td>  <td>狀態變數版</td>  <td>try-finally版</td> </tr><tr>  <td>goto語法</td>  <td></td>  <td>可避開</td>  <td>可避開</td>  <td>可避開</td> </tr><tr>  <td>巢狀if的語法</td>  <td>可避開</td>  <td></td>  <td>可避開</td>  <td>可避開</td> </tr><tr>  <td>其它</td>  <td>避開額外測試</td>  <td>產生複雜的程式碼</td>  <td>需加入額外測試</td>  <td>並不是每個語言都支援</td> </tr></tbody></table><br /><br /><h4>goto與共享在else裡的代碼<br />gotos and Sharing Code in an else Clause</h4><br /><b><span style="font-size: large;">goto版 </span></b><br /><pre class="prettyprint"><code class="language-cpp">if ( statusOk ) {<br />    if ( dataAvailable ) {<br />        importantVariable = x;<br />        goto MID_LOOP;<br />    }<br />}<br />else {<br />    importantVariable = GetValue();<br /><br />    MID_LOOP:<br /><br />    // lots of code<br />    ...<br />}</code></pre><span style="font-size: large;"><b>呼叫常式版 </b></span><br /><pre class="prettyprint"><code class="language-cpp">if ( statusOk )<br />{<br />    if ( dataAvailable )<br />    {<br />        importantVariable = x;<br />        DoLotsOfCode( importantVariable );<br />    }<br />}<br />else<br />{<br />    importantVariable = GetValue();<br />    DoLotsOfCode( importantVariable );<br />}</code></pre><b><span style="font-size: large;">重建條件式版 </span></b><br /><pre class="prettyprint"><code class="language-cpp">if ( ( statusOk &amp;&amp; dataAvailable ) || !statusOk )<br />{<br />    if ( statusOk &amp;&amp; dataAvailable )<br />    {<br />        importantVariable = x;<br />    }<br />    else<br />    {<br />        importantVariable = GetValue();<br />    }<br /><br />// lots of code<br />...<br />}</code></pre><br /><h4>goto的使用原則和心得<br />Summary of Guidelines for Using gotos</h4><br />goto的使用與否取決於信仰。<br />goto()代表效率。<br /><br /><h3><span style="font-size: large;">17.4 剖析不常見的流程控制程式結冓<br />Perspective on Unusual Control Structures</span></h3><br />
