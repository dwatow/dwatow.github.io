---
title: "MFC檔案讀寫、相對應的例外處理"
date: 2012-01-31T11:32:00.000+08:00
tags: 
- "WIN32 API/MFC"
categories:
- 舊部落格移植文章
---

# MFC檔案讀寫、相對應的例外處理

原文連結: https://darkblack01.blogspot.com/2012/01/cfile-cmemfile-csharefile.html
移植時的最後更新日期: 2012-02-01T08:56:42.091+08:00

<span style="font-family: Verdana, sans-serif;"><b>檔案讀寫類別</b></span><br /><br /><span style="font-family: Verdana, sans-serif;"><b>CFile</b></span><br /><span style="font-family: Verdana, sans-serif;">├<b>CMemFile　好的執行效能</b></span><br /><span style="font-family: Verdana, sans-serif;">│└<b>CShareFile　記憶體中，可以共享檔案</b></span><br /><span style="font-family: Verdana, sans-serif;">├COleStreamFile</span><br /><span style="font-family: Verdana, sans-serif;">│└&nbsp;CMonikerFile</span><br /><span style="font-family: Verdana, sans-serif;">│　└&nbsp;CAsyncMonikerFile</span><br /><span style="font-family: Verdana, sans-serif;">│　　└&nbsp;CDataPathProperty</span><br /><span style="font-family: Verdana, sans-serif;">│　　　└&nbsp;CCachedDataPathProperty</span><br /><span style="font-family: Verdana, sans-serif;">├CScoketFile</span><br /><span style="font-family: Verdana, sans-serif;">└<b>CStdioFile　有緩衝區　標準輸出入檔案</b></span><br /><span style="font-family: Verdana, sans-serif;">　└CInternetFile</span><br /><span style="font-family: Verdana, sans-serif;">　　├CGopherfile</span><br /><span style="font-family: Verdana, sans-serif;">　　└CHttpFile</span><br /><br /><a name='more'></a><br /><br /><span style="font-family: Verdana, sans-serif;">CFile</span><br /><span style="font-family: Verdana, sans-serif;">是否新建檔案，開&amp;讀舊檔，唯讀寫，禁止共享（讀或寫）</span><br /><span style="font-family: Verdana, sans-serif;">（使用Win32API）</span><br /><span style="font-family: Verdana, sans-serif;"></span><br /><span style="font-family: Verdana, sans-serif;">CStdioFile</span><span style="font-family: Verdana, sans-serif;">可指定文字模式、二進位模式開檔</span><br /><span style="font-family: Verdana, sans-serif;">（使用C語言函式）</span><br /><span style="font-family: Verdana, sans-serif;"></span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">讀取的資料量 &nbsp; CStdioFile.<b>Read</b>(指標 讀取資料的記憶體位址, UINT 欲讀取的資料量);</span><br /><br /><br /><span style="font-family: Verdana, sans-serif;">StringRead()的用法類似Read()</span><br /><span style="font-family: Verdana, sans-serif;">除了：</span><br /><span style="font-family: Verdana, sans-serif;">1. 讀取到'\n'結束。</span><br /><span style="font-family: Verdana, sans-serif;">2. 輸出結束自動加上null。</span><br /><span style="font-family: Verdana, sans-serif;">3. 會「回傳（讀取的）記憶體位址」，若讀不到東西回傳null。</span><br /><br /><span style="color: #0b5394;">讀取資料的記憶體位址&nbsp; &nbsp;CStdioFile.<b>StringRead</b>(指標 讀取資料的記憶體位址&nbsp;, UINT 欲讀取的資料量);</span><br /><br /><span style="color: #0b5394;">BOOL &nbsp; CStdioFile.<b>StringRead</b>(CString&amp;);</span><br /><br /><br /><br /><span style="font-family: Verdana, sans-serif;"><b>檔案的例外處理類別</b></span><br /><br /><span style="font-family: Verdana, sans-serif;">CException</span><br /><span style="font-family: Verdana, sans-serif;">└<b>CFileException</b></span><br /><br /><span style="font-family: Verdana, sans-serif;">例外處理範例：</span><br /><br /><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;"><b>try</b></span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">{</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; <b>CFile </b>MyFile("MyFile.old", CFile::modeRead);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">}</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;"><b>catch</b>(<b>CFileException </b>*fx)</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">{</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; <b>TCHAR </b>buf[255];</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; fx-&gt;GetErrorMessage(buf, 255);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; <b>CString </b>strPrompt(buf);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; AfxMessageBox(strPrompt);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">}</span><br /><br /><span style="font-family: Verdana, sans-serif;">或者</span><br /><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;"><b>CFile </b>MyFile;</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;"><b>CFileException </b>fx;</span><br /><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">if(!MyFile.Open("Myfile.old", CFile::modeRead, &amp;fx))</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">{</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp;&nbsp;<b>TCHAR&nbsp;</b>buf[255];</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; fx.GetErrorMessage(buf, 255);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp;&nbsp;<b>CString&nbsp;</b>strPrompt(buf);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">&nbsp; &nbsp; AfxMessageBox(strPrompt);</span><br /><span style="color: #0b5394; font-family: Verdana, sans-serif;">}</span>
